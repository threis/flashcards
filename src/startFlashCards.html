<!DOCTYPE html>
<html lang="pt-BR">
<title>Flashcards</title>
<link rel="stylesheet" href="styles.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="wrapper">

            <p id="id" style="display:none"></p>
            <p id="phrase"></p>
            <button onClick="toggleQuestionAndAnswer()" id="question-answer-btn">Visualizar Resposta</button>
            <button onClick="nextQuestion()" id="next-btn" style="display:none">Próximo card</button>
            <button onClick="quitApp()" id="quit-btn" style="display:none">Finalizar</button>

        </div>
    </div>

    <script type="module">

        async function loadFlashcards() {

            try {
                const resp = await fetch("http://localhost:3000/flashcards", {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                const data = await resp.json()
                return data
            } catch (err) {
                console.log(`Error: ${err}`)
            }
        }

        const flashcards = await loadFlashcards()

        if (flashcards.length === 0) {
            document.querySelector('#phrase').innerHTML = 'Nenhuma frase para estudar no momento'
        } else {
            window.flashcards = flashcards
            document.querySelector('#id').innerHTML = flashcards[0].id
            document.querySelector('#phrase').innerHTML = flashcards[0].front
        }

    </script>
    <script>
        function toggleQuestionAndAnswer() {
            const id = parseInt(document.querySelector('#id').innerHTML)
            const card = flashcards.find(item => item.id === id)
            document.querySelector('#phrase').innerHTML = card.back
            document.querySelector('#question-answer-btn').style.display = 'none'
            const index = flashcards.indexOf(card)

            if (flashcards.length === index + 1) {
                document.querySelector('#quit-btn').style.display = 'block'
            } else {
                document.querySelector('#next-btn').style.display = 'block'
                document.querySelector('#id').innerHTML = id + 1
            }
        }

        function nextQuestion() {
            document.querySelector('#next-btn').style.display = 'none'
            document.querySelector('#question-answer-btn').style.display = 'block'
            const id = parseInt(document.querySelector('#id').innerHTML)
            const card = flashcards.find(item => item.id === id)
            document.querySelector('#phrase').innerHTML = card.front
        }

        function quitApp() {
            alert('Parabéns, você revisou todos os cartões!')
            document.querySelector('#id').innerHTML = flashcards[0].id
            document.querySelector('#phrase').innerHTML = flashcards[0].front
            document.querySelector('#question-answer-btn').style.display = 'block'
            document.querySelector('#next-btn').style.display = 'none'
            document.querySelector('#quit-btn').style.display = 'none'
            const electron = require('electron');
            const ipc = electron.ipcRenderer;
            ipc.send('close-start-flashcards')
        }
    </script>
</body>

</html>